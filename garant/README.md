# Сборщик БЭМ-проектов на основе enb
Данная сборка основана на enb-bem https://ru.bem.info/tools/bem/enb-bem/
Уже настроена сборка merged-бандла. Почти все что относится непосредственно к БЭМ находится в подпапке bem/


## Установка

Для работы сборщика требуется установка (и доступность из командной строки):

- NodeJS v5 https://nodejs.org/en/download/stable/
- Git https://git-scm.com/download/
- Python v2.7 https://www.python.org/download/releases/2.7/


Установка NodeJS-пакетов необходимых для работы сборщика:
```
npm i
npm ddp
```

В случае если при выполнении `npm i` возникают ошибки, выполните минимальные необходимые требования для работы пакета https://github.com/nodejs/node-gyp


## Запуск
- `npm run server` - запуск локального веб-сервера
- `npm run make` - сборка всего проекта + документации + примеров
- `npm run prod` - сборка проекта в режиме production
- `npm run dist` - генерация production-zip-архива всей сборки (сохраняется на уровень выше)
- `npm run clean` - очистка (удаление автогенерируемых файлов)

Пользователям Windows доступны все эти команды с добавлением `w` на конце. Например, `npm run cleanw`


## Плагины

Если вы используете какие-либо плагины (JS/CSS), рекомендуется устанавливать их через bower (см. bower.json в корне проекта), чтобы при обновлении плагина в репозитории ваша верстка легко получала данное обновление.
Зависимости, установленные таким образом складываются в папку bower_components/ откуда могут быть подключены способами описанными ниже.


## JavaScript
Для подключения внешнего JS-файла внутрь вашего (например внешний плагин из bower_components) можно использовать конструкцию `/*=include ../../../bower_components/myplugin/plugin.min.js */`
При сборке JS сначала производится минификация JS а затем обрабатывается include. Поэтому подключать имеет смысл уже минифицированные JS.


## SASS, CSS
Корректно обрабатываются include-конструкции, локальные ссылки на картинки и шрифты преобразовываются при сборке. Т.е. можно ссылаться на файлы стилей/картинок/шрифтов относительно текущей папки.


## Modernizr
Cборка позволяет включать в проект плагин "Modernizr"" только с нужным набором параметров. Для этого необходимо сгенерировать конфигурационный файл на странице https://modernizr.com/download и сохранить его под имененем modernizr.json в корне проекта.

После замены конфигурационного файла необходимо запустить команду
- `gulp build_modernizr`

Важно! Modernizr загружается асинхронно, поэтому использовать его из JS нужно осторожно


## jQuery UI
Для изменения темы оформления рекомендуется сформировать новую тему через конструктор http://jqueryui.com/themeroller/

После этого необходимо на уровне blocks.project переопределить технологию CSS блока jquery-ui-theme
В CSS-файл необходимо записать только CSS со сгенерированной темой (theme.css из http://jqueryui.com/themeroller/).
Остальные CSS заменять не нужно.

К jQuery UI автоматически подключается плагин "Touch Punch" для поддержки touch-событий. Он должен быть подключен после jQuery UI Mouse но до первого использования. В большинстве случаев все будет хорошо, а в случае беды объявите зависимость mustDeps вашего блока от jquery-ui-touch-punch


## Переводы
По умолчанию для всех JS-плагинов поддерживающих разные языки мы обязуемся добавлять в репозиторий русский и английский (см
jquery-ui-datepicker).

Другие языки описывать самостоятельно.


## Шрифты
В типовой сборке есть уровень blocks.03-fonts, содержащий технологию провдинутой загрузки шрифтов (обычных и иконочных). Обратите внимание, что по умолчанию этот уровень отключен.
Суть технологии отражена в статье https://www.filamentgroup.com/lab/font-events.html (ее адаптация на русский https://habrahabr.ru/company/paysto/blog/268771/).

Правильное использование данной технологии выглядит следующим образом:
1. Скачать и положить локально. Для Google Fonts рекомендуется использовать https://google-webfonts-helper.herokuapp.com/ (не забываем выбрать поддержку кирилицы). Если получаете шрифты другим способом, следите чтобы у вас были скачаны все файлы woff/ttf/eot и другие + все они были описаны в CSS.
2. Файлы шрифтов сохранить в bem/blocks.03-fonts/custom-fonts/fonts
3. CSS шрифтов сохранить в bem/blocks.03-fonts/custom-fonts/custom-fonts.css
3. Описать кастомные шрифты в файле bem/blocks.03-fonts/custom-fonts/config.js (см справку внутри)
4. Подключить уровень blocks.03-fonts в config.js в корне проекта
5. Задать кастомные шрифты для необходимых блоков в виде `.custom-fonts_loaded h1 {font-family: 'MyCustomFontFamily'}`
6. Отладить ширину/размер fallback-шрифта чтобы текст не прыгал при замене системного шрифта на кастомный (рекомендуется использовать букмарклет http://ffffallback.com/)


## Спрайты
Создаются в режиме production для картинок описанных в соответствии с https://github.com/glebmachine/postcss-easysprites (нужно просто указать якорь у картинок в вашем CSS)


## BEMJSON
Сборка подерживает включение одного bemjson в другой посредством require. Пример:
```
content: [
    require('../_common/header.bemjson.js'),
    {
        block: 'container',
        content: '...'
    },
    require('../_common/footer.bemjson.js')
]
```

Рекомендуется использовать такой подход для сборки повторяющихся частей (товары в списке, шапка/подвал и т.д.).
Сборка запоминает какие файлы были подключены (рекурсивно) и пересобирает страницу если изменился любой из подключаемых.


## Документация и примеры
Собираются при выполнении команды `npm run make(w)`. Первичные данные - такие же как в библиотеках bem-core, bem-components.
Результат - папки  bem/docs, bem/examples.


# Важно
Почитайте содержимое config.json в корне проекта - возле каждого параметра есть комментарий зачем он нужен.
Изменения в config.json [languages] требуют выполнения очистки (см команду clean/cleanw).


# Кеширование и пересборка
Постоянно должны пересобираться только следующие техники:
- file-provider
- levels
- files

Все остальные техники должны пересобираться только в случае если что-то изменилось. Если вы видите слишком много сообщений [rebuild] даже если ничего не меняли - в сборку закралась ошибка.



# TODO
- dev/не dev в js/css/html
- Описать как делать бутстраповские блоки
- Соглашение о хранении глобальных переменных и настроек js/sass
- require html
- https://github.com/alekseykulikov/touch-action
- css-lint (код закомментирован, ждем версию 1.0 или переделать на https://css-tricks.com/stylelint/) / js-hint (replace with ESLint) / boot-lint
- минимальные версии браузеров
- http://getbootstrap.com/getting-started/#select-menus

"YENV" не является внутренней или внешней
